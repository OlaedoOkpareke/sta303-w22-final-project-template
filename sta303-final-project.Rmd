---
title: "Report title"
subtitle: "Subtitle that indicates findings"
author: "Report prepared for MINGAR by Arpesso"
date: 2022-04-07
lang: "en"
output:
  pdf_document:
    template: report.tex
    toc: true
    toc_depth: 2
titlepage: true
titlepage-color: "6C3082"
titlepage-text-color: "FFFFFF"
titlepage-rule-color: "FFFFFF"
titlepage-rule-height: 2
---

```{r, message = FALSE, echo=FALSE}
library(tidyverse)
library(lme4)
library(rvest)
library(polite)
library(lmtest)

# this should suppress all code and messages
knitr::opts_chunk$set(include=FALSE)
```

# General comments (you can delete this section)

_Before making any changes, knit this Rmd to PDF and change the name of the PDf to something like 'original-instructions.pdf', or whatever you like (it is just for your reference).. Then you can delete this section and if you want to check what it said, just open the other PDF. You don't HAVE to use this particular template, but you DO need to write you report in RMarkdown and include a cover page._

_The cover page must be a single stand alone page and have:_

*	_A title and subtitle (that indicate your findings)_
* _"Report prepared for MINGAR by" your company name_
*	_Date (assessment submission date is fine)_

_You can change the colour of this cover to any colour you would like by replacing 6C3082 in the YAML above (`titlepage-color:`) to another hex code. You could use this tool to help you:_ https://htmlcolorcodes.com/color-picker/

_Note: There should NOT be a table of contents on the cover page. It should look like a cover._

\newpage
# Executive summary

_Guidelines for the executive summary:_

* _No more than two pages_
* _Language is appropriate for a non-technical audience_
* _Bullet points are used where appropriate_
*	_A small number of key visualizations and/or tables are included_
*	_All research questions are addressed_


_The [module 4 writing prompt](https://sta303-bolton.github.io/sta303-w22-courseguide/knowledge-basket-writing-and-peer-feedback.html#module-4-writing-task) provides some tips and information about writing executive summaries._


\newpage
# Technical report
_This part of the report is much more comprehensive than the executive summary. The audience is statistics/data-minded people, but you should NOT include code or unformatted R output here._

We included all variables to make sure it wasnt a fault of inherent qualities of the device. Do we do eda here? After checking our model was the best. I checked asumptions of ... state poisson assumptions. eg plot 1 shows assumptions of model is satisfied? show model summary but not actual code. How do i put anova into a summary table? You dont, justbsay that i compared some models to toher models and say this was best. If the actual model should be showed here, where do we put the fact that we had an original model? 

## Introduction

_Provide a brief introduction to your report and outline what the report will cover. This section is valuable for setting scope and expectations. _

### Research questions
_Use bullet points to to describe the research questions you are going to address. Write in full sentences._

After accounting for other possible explanations, do Mingar devices flag darker skinned users of their sleep devices more than lighter skinned users per minute of sleep? 

## Mingar Devices are more likely to flag darker skinned users than lighter skinned users

_For each research question, you will want to briefly describe any data manipulation, show some exploratory plots/summary tables, report on any methods you use (i.e. models you fit) and the conclusions you draw from these_
Using the emoji color as proxy
The table shows the summary data on number of flags for all wearers of the devices over the several nights. 
```{r}
cust_full %>%
    group_by(emoji_modifier) %>%
    dplyr::summarize(MeanCount = mean(flags, na.rm=TRUE),
              VarCount = var(flags, na.rm=TRUE),
              MeanRate = mean(flags/duration, na.rm=TRUE),
              VarRate = var(flags/duration, na.rm=TRUE),
              n = n()) %>% 
  knitr::kable(booktabs=T, 
        caption = 'The mean and variance of flags in slap by skin tone emoji.')
```

We see that the mean and variance of darker skinned people tends to be more than light. This indicates that there might be a problem with race for them. 


We look at the proportion of people in each race group

```{r}
with(cust_full,(prop.table(table(emoji_modifier)))) %>% 
  knitr::kable(caption = 'Proportion of colleges and universities within region in the campus crime data set.')
```

The data on flags shows a rightly skewed graphs with many values at 0. We see that darker skin tones tend to have higher values. 
```{r}
cust_full %>%
  ggplot(data =., aes(x=flags, fill = emoji_modifier)) +
  geom_histogram()+ 
  theme_minimal()
# seems it is poisson, due to rightly skewed graph. 
```

We create a model to find the relationship between sleep flags per minute and race, as well as visualize the data, and analyze information on flags and several explanatory variables. 

We have seen that distribution of response is poisson, and the mean and variance are very close. 
To create the possible explanatory models, we created an age variable by subtracting the date of birth of the individual from date of analysis; March 30th 2022. For further visualization, we divided the ages into seperate age groups by decade.  We decided not to remvoe the yellow skin emojis as removing the large amount of variables could cause bias to the model. 
We first created a model that had all characteristics of the individual and device. That is, race, sex, age, and the device type. For this model, we dropped missing variables in sex in order to compare it to the other model. 

After running a summary on this model we found that only the proxy variable for race and the age variables were significant. Performing an anova test showed that there was no evidence against the null hypothesis (0.2137) that the model involving only the race proxy and sex was better than the model that included the other variables. A residual plot of this model shows that the residual plots look sctattered with no fanning, indicating constant variance of errors. We assume mingar has chosen their wearers independently. 

Our final model is thus $$ log(flag) = \mu + \alpha_{ij1} + \alpha_{ij2} + \beta_j $$ 
where $ \mu$ is grand mean of flags
$\alpha_i1$ is emoji skin tone of person i, fixed effect for day j
$\alpha_i2$ is age of person i, fixed effect for day j
$\beta_j$ is the customer id of the person, to account for problems with independence within the same wearer. for day j
It is offset by duration, to account for the different minutes of sleep peopke have, so rates of flags

Check t tests if there's a problem 
```{r}
# Are the proportions of people being flagges  similar across race?
prop.table(table(risk2009$sex, risk2009$lose.wt), 1)
chisq.test(risk2009$lose.wt, risk2009$sex)

# Are the proportions of people being flagges  similar across age?
prop.table(table(risk2009$sex, risk2009$lose.wt), 1)
chisq.test(risk2009$lose.wt, risk2009$sex)
```


exact model can be interpeted with the coefficients and confidence intervals as 

```{r}
# how to properly do confit for the model?
par_table = cbind(est = summary(
  modrace2)$coef[,1],
  confint(modrace2))
rownames(par_table)[1]= "Intercept"

round(exp(par_table),3) %>% 
  knitr::kable(caption = "table.")
# sth is wrong with this table
```

Interpreting this, we see that there are significant differences between skin tones, witht he flags becoming more prevalent as skin tones go up. So we see that holding age relavent, skin tone does have an effect on false flag for disruption. Also holding race constant, age also affects sleep scores by... 


we also see effect of race by 

```{r}
ggplot(data = cust_full, aes(x = flags, fill = emoji_modifier)) +
  geom_bar(position = "fill") +
  scale_fill_grey() +
  theme_minimal() +
  labs(fill = "Skin Tone", x = "Flags", y = "Proportion")
```

As stated earlier, age is also significant we see this by 

```{r}
plot <- cust_full %>% group_by(age) %>% 
  summarise(mnflag = mean(flags),
            logmnflag = log(mnflag), n=n())
ggplot(plot, aes(x=age, y=logmnflag)) +
  geom_point()+
  geom_smooth(method = "loess", size = 1.5)+
  xlab("Age of the person") +
  ylab("Log of the empirical mean number of flags") +
  theme_minimal()
```

```{r}
cust_full %>%
    group_by(age_group) %>%
    dplyr::summarize(MeanCount = mean(flags, na.rm=TRUE),
              VarCount = var(flags, na.rm=TRUE),
              MeanRate = mean(flags/duration, na.rm=TRUE),
              VarRate = var(flags/duration, na.rm=TRUE),
              n = n()) %>% 
  knitr::kable(booktabs=T, 
        caption = 'The mean and variance of flags in slap by skin tone emoji.')
```
Interaction between main variable and other variable 
```{r}
with(cust_full,round(prop.table(table(emoji_modifier,age_group),1),3)) %>% 
  knitr::kable(caption = 'Proportion of colleges and universities within region in the campus crime data set.')
```


```{r}
round(summary(bRes)$coef, digits=2)
```



## Informative title for section addressing a research question


## Discussion

_In this section you will summarize your findings across all the research questions and discuss the strengths and limitations of your work. It doesn't have to be long, but keep in mind that often people will just skim the intro and the discussion of a document like this, so make sure it is useful as a semi-standalone section (doesn't have to be completely standalone like the executive summary)._

### Strengths and limitations
Limitation: people could use different skin tones, and then all the people that used yellow emojis. NA was dropped from the model. Mean was not always that close to variance, so overdispersion? The goodness of fit doesnt fit well? why is this? (check textbook chapter)
Postcode measures are not perfectly comparable for a single person, but gives the general area of the wealthj in that neighbourhood
\newpage
# Consultant information
## Consultant profiles

*Complete this section with a brief bio for each member of your group. If you are completing the project individually, you only need to complete one for yourself. In that case, change the title of this section to 'Consultant profile' instead. Examples below. This section is only marked for completeness, clarity and professionalism, not 'truth' so you can write it as if we're a few years in the future. Put your current degree in as completed and/or add your first choice grad school program, whatever you like. What skills related skills would you most like to highlight? What job title do you want?*

**Thomas D'Onofrio** Statsy is a senior consultant with Eminence Analytics. She specializes in data visualization. Statsy earned her Bachelor of Science, Specialist in Statistics Methods and Practice, from the University of Toronto in 2023.

**Pablo Mercado**. Statsy is a senior consultant with Eminence Analytics. She specializes in data visualization. Statsy earned her Bachelor of Science, Specialist in Statistics Methods and Practice, from the University of Toronto in 2023.

**Olaedo Okpareke**. Olaedo Okpareke is a senior consultant at Arpesso Analytics. She specializes in statistical anaylsis and data visualization in R and Python. Olaedo also specializes in statstical surveys and sampling, as well as financial risk analysis. Olaedo earned her Bachelor od Science in Economics and Statistics from the University of Toronto in 2023, and her masters in Economics Data analysis from University of Toronto in 2026. 

**Walid Roudani**. Datana is a junior consultant with Eminence Analytics. They specialize in reproducible analysis and statistical communication. Datana earned their Bachelor of Science, Majoring in Computer Science and Statistics from the University of Toronto in 2024.

## Code of ethical conduct

_This section should be fairly short, no more than half a page. Assume a general audience, much like your executive summary._

* _Make at least three relevant statements about your company's approach to ethical statistical consulting. These should be appropriately in line with professional conduct advice like the (Statistical Society of Canada Code of Conduct)[https://ssc.ca/sites/default/files/data/Members/public/Accreditation/ethics_e.pdf] or the (Ethical Guidelines for Statistical Practice from the American Statistical Society)[https://www.amstat.org/ASA/Your-Career/Ethical-Guidelines-for-Statistical-Practice.aspx]. For example, "the customer is always right" ISN'T the type of thing an ethical statistical consultant would include._
*	_Be very careful not to just copy and paste from these other documents! Put things in your own words._


\newpage
# References

_You don't need to cite course materials, but consider all the the places you got data from, as well as the packages used and R itself. These are all things you should consider citing. Likewise, you might use some external resources on the emoji skin tones/Fitzpatrick scale, etc._

\newpage
# Appendix
Appendix should have the tables which support was was said in the main body. 
_These appendices should outline in more detail the steps taken to access the following datasets. They should NOT include code, but should briefly describe the steps and important considerations. I.e., show that you understand what needs to be considered when web scraping, protecting licensed data, etc._

## Web scraping industry data on fitness tracker devices

## Accessing Census data on median household income

## Accessing postcode conversion files


__Final advice: KNIT EARLY AND OFTEN!__
